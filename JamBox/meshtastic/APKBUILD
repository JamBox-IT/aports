
# Contributor: Corey DeLasaux <cordelster@gmail.com>
# Maintainer: Corey DeLasaux <cordelster@gmail.com>
pkgname=jb_meshtastic
_pkgreal=meshtastic
pkgver=2.2.22
pkgrel=0
pkgdesc="client shell for talking to Meshtastic devices"
url="http://packages.python.org/pypi/meshtastic"
arch="all"
license="GPL-3.0-only"
depends="python3 py3-cryptography py3-importlib-metadata py3-jaraco.functools py3-jaraco.text py3-simplejson py3-queuelib py3-bcrypt py3-brotli
 py3-python-socks py3-async-timeout py3-platformdirs py3-openssl py3-urllib3-secure-extra py3-urllib3 py3-protobuf py3-requests py3-pexpect 
py3-pyserial py3-yaml py3-timeago py3-dotmap py3-pypubsub py3-tabulate py3-pyqrcode py3-bleak py3-meshtastic"
checkdepends="python3-dev py3-pytest py3-pytest-covi py3-pylint"
makedepends="py3-setuptools py3-wheel py3-bleak py3-pyinstaller py3-pyinstaller-hooks-contrib py3-numpy-dev musl cython ocaml-ctypes-dev"
options="!check"

source="meshtastic.spec"
builddir="$srcdir/$_pkgreal-$pkgver"

prepare() {
	default_prepare
	mkdir -p "$builddir"
	install -m774 "$srcdir"/meshtastic.spec "$builddir"/meshtastic.spec
}

build() {
	cd $builddir
	pyinstaller --onefile --copy-metadata meshtastic --collect-submodules meshtastic --hidden-import charset_normalizer.md__mypyc /usr/bin/meshtastic
	
}

check() {
	python3 setup.py test
}

package() {
	mkdir -p "$pkgdir"
	cd "$pkgdir"
	install -m 0755 -d \
		usr \
		usr/bin

	install -m755 "$builddir"/dist/meshtastic "$pkgdir"/usr/bin/meshtastic

}

sha512sums="
f1ede02470344c7525b655a8a27ce47330cb80e0f9c8a0629b755112f5c937324a942ce176c95b79f688015827c315fd8b633dfab55156beef3fcce14d922a4b  meshtastic.spec
"
