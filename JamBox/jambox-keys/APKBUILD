# Maintainer: Corey De Lasaux <cordelster@gmail.com>
pkgname=jambox-keys
pkgver=0.1
pkgrel=10
pkgdesc="Public keys for JamBox Alpine Linux packages"
url="https://alpinelinux.org"
# we install arch specific keys to /etc so we cannot do arch=noarch
arch="all"
license="MIT"
replaces="alpine-base"
options="!check" # No testsuite

_arch_keys="
	x86,x86_64,aarch64,armhf,armv7:jambox-65ea124a.rsa.pub
	x86,x86_64,aarch64,armhf,armv7:jambox-698d435a.rsa.pub
	x86,x86_64,aarch64,armhf,armv7:jb-CAwEAAQ.pub
	"

for _i in $_arch_keys; do
	source="$source ${_i#*:}"
done

_ins_key() {
	msg "- $2 ($1)"
	install -Dm644 "$srcdir"/$2 "$pkgdir"/etc/apk/keys/$2
}

_install_x86() {
	case "$1" in
	x86*) _ins_key $1 $2 ;;
	esac
}

_install_arm() {
	case "$1" in
	aarch64|arm*) _ins_key $1 $2 ;;
	esac
}

_install_ppc() {
	case "$1" in
	ppc*) _ins_key $1 $2 ;;
	esac
}

_install_s390x() {
	case "$1" in
	s390x) _ins_key $1 $2 ;;
	esac
}

_install_mips() {
	case "$1" in
	mips64) _ins_key $1 $2 ;;
	esac
}

_install_riscv() {
	case "$1" in
	riscv*) _ins_key $1 $2 ;;
	esac
}

_install_loongarch() {
	case "$1" in
	loongarch*) _ins_key $1 $2 ;;
	esac
}

package() {
	# copy keys for repos
	mkdir -p "$pkgdir"/etc/apk/keys
	for i in $_arch_keys; do
		_archs="${i%:*}"
		_key="${i#*:}"
		install -Dm644 "$srcdir"/$_key \
			"$pkgdir"/usr/share/apk/keys/$_key

		for _arch in ${_archs//,/ }; do
			mkdir -p "$pkgdir"/usr/share/apk/keys/$_arch
			ln -s ../$_key "$pkgdir"/usr/share/apk/keys/$_arch/

			case "$CARCH" in
			x86*) _install_x86 $_arch $_key ;;
			arm*|aarch64) _install_arm $_arch $_key ;;
			ppc*) _install_ppc $_arch $_key ;;
			s390x) _install_s390x $_arch $_key ;;
			mips*) _install_mips $_arch $_key ;;
			riscv*) _install_riscv $_arch $_key ;;
			loongarch*) _install_loongarch $_arch $_key ;;
			esac
		done
	done
}

sha512sums="
2883fb7022e436b83c07d55973e408abe7d66dec4d0ff09baa291f7a7aec6397af3e3bf9ed51276602cab283349de90bc759c483064b5101d3b8a5013493420c  jambox-65ea124a.rsa.pub
0453c3fb16eb68e218683adaa338a3195b9be5fc4c8a7d2f2dc6b5016294025468409fab91ebcba9853b195ef7e7537ebb13e40f36350724dca34a57a0a5d4e1  jambox-698d435a.rsa.pub
bc359f74107f077aa60d0366371d938288157b06c399ed5abc5f35f5e9b63aaf49541a5492c161e31b6de34305348b95059273956e0b030fac6713b542c9488a  jb-CAwEAAQ.pub
"
